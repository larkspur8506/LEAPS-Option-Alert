{% extends "base.html" %}

{% block title %}规则配置{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">规则配置</h1>
        <a href="/admin" class="text-blue-600 hover:text-blue-800">返回 Dashboard</a>
    </div>

    <form action="/admin/rules" method="post" class="space-y-8">
        <!-- QQQ 入场规则 (新版 Level 1/2/3) -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">🟢 QQQ 入场规则</h2>
            <p class="text-gray-600 mb-4">启用或禁用分级入场提醒规则</p>

            <div class="space-y-3">
                <label class="flex items-center">
                    <input type="checkbox" name="entry_level1_enabled" {% if config.entry_level1_enabled %}checked{%
                        endif %} class="mr-2">
                    <span class="text-gray-700"><strong>Level 1 (日常回调):</strong> 跌幅 ≥ 1.2% 且触碰 MA20</span>
                </label>

                <label class="flex items-center">
                    <input type="checkbox" name="entry_level2_enabled" {% if config.entry_level2_enabled %}checked{%
                        endif %} class="mr-2">
                    <span class="text-gray-700"><strong>Level 2 (黄金坑):</strong> 3日累计跌幅 ≥ 3.5% 且 RSI &lt; 32</span>
                </label>

                <label class="flex items-center">
                    <input type="checkbox" name="entry_level3_enabled" {% if config.entry_level3_enabled %}checked{%
                        endif %} class="mr-2">
                    <span class="text-gray-700"><strong>Level 3 (极端超卖):</strong> 价格跌破布林下轨</span>
                </label>
            </div>
        </div>

        <!-- 期权止盈规则 -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">🎯 期权止盈规则</h2>
            <p class="text-gray-600 mb-4">启用或禁用多维止盈提醒</p>

            <div class="space-y-3">
                <label class="flex items-center">
                    <input type="checkbox" name="exit_hard_tp_enabled" {% if config.exit_hard_tp_enabled %}checked{%
                        endif %} class="mr-2">
                    <span class="text-gray-700"><strong>🎯 硬性止盈:</strong> 盈利达到 50%</span>
                </label>

                <label class="flex items-center">
                    <input type="checkbox" name="exit_fast_tp_enabled" {% if config.exit_fast_tp_enabled %}checked{%
                        endif %} class="mr-2">
                    <span class="text-gray-700"><strong>🚀 极速止盈:</strong> 持仓 ≤ 7天且盈利达到 15%</span>
                </label>

                <label class="flex items-center">
                    <input type="checkbox" name="exit_trailing_tp_enabled" {% if config.exit_trailing_tp_enabled
                        %}checked{% endif %} class="mr-2">
                    <span class="text-gray-700"><strong>📉 移动止盈:</strong> 最高收益 &gt; 30% 后回撤超过 10%</span>
                </label>

                <label class="flex items-center">
                    <input type="checkbox" name="exit_tech_tp_enabled" {% if config.exit_tech_tp_enabled %}checked{%
                        endif %} class="mr-2">
                    <span class="text-gray-700"><strong>⚠️ 技术止盈:</strong> QQQ RSI &gt; 75 或突破布林上轨</span>
                </label>
            </div>
        </div>

        <!-- 期权风控规则 -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">🛡️ 期权风控规则</h2>
            <p class="text-gray-600 mb-4">启用或禁用时间和趋势风控提醒</p>

            <div class="space-y-3">
                <label class="flex items-center">
                    <input type="checkbox" name="exit_dte_warning_enabled" {% if config.exit_dte_warning_enabled
                        %}checked{% endif %} class="mr-2">
                    <span class="text-gray-700"><strong>⏳ 移仓窗口:</strong> DTE &lt; 120 天提醒</span>
                </label>

                <label class="flex items-center">
                    <input type="checkbox" name="exit_dte_force_enabled" {% if config.exit_dte_force_enabled %}checked{%
                        endif %} class="mr-2">
                    <span class="text-gray-700"><strong>⛔ 强制清仓:</strong> DTE &lt; 90 天提醒</span>
                </label>

                <label class="flex items-center">
                    <input type="checkbox" name="exit_trend_stop_enabled" {% if config.exit_trend_stop_enabled
                        %}checked{% endif %} class="mr-2">
                    <span class="text-gray-700"><strong>🛑 趋势崩坏:</strong> QQQ 有效跌破 MA200</span>
                </label>
            </div>
        </div>

        <!-- 期权参数配置 -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">⚙️ 参数配置</h2>
            <p class="text-gray-600 mb-4">配置期权持仓和止损相关参数</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">最大持仓天数</label>
                    <input type="number" name="max_holding_days" value="{{ config.max_holding_days }}" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-md">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">止损阈值 (%)</label>
                    <input type="number" step="0.01" name="stop_loss_threshold" value="{{ config.stop_loss_threshold }}"
                        required class="w-full px-4 py-2 border border-gray-300 rounded-md">
                    <p class="text-xs text-gray-500 mt-1">例如 0.30 表示 -30%</p>
                </div>

                <div class="flex justify-end">
                    <button type="submit"
                        class="bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700 transition">
                        保存配置
                    </button>
                </div>

    </form>
</div>
{% endblock %}